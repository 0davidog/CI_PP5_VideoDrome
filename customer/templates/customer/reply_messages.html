{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}


{% block content %}
<div class="container">

    <div class="row mb-5">

        <div class="col-12 col-xl-6 mb-2">
            <h2>Reply</h2>
            
        </div>

        <div class="col-12 col-xl-6 text-end">
            <a href="{% url 'customer_info' %}" class="btn btn-secondary">Return</a>
        </div>

    </div>
    <hr>

    <div class="row mb-5">
        <div class="col">
            <p class="text-muted">You can send us a message via this form and one of our team will get back to you ASAP</p>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col">
            <form id="message_form" method="POST" action="{% url 'reply_messages' message_thread.id %}">
                {% csrf_token %}
                <p class="text-muted">
                    Email: {{ message_thread.user_email }}
                    <div class="d-none">{{ message_form.user_email | as_crispy_field }}</div>
                    
                </p>
                <p class="text-muted">
                    Subject: {{ message_thread.subject }}
                    <div class="d-none">{{ message_form.subject | as_crispy_field }}</div>
                    
                </p>
                <p class="text-muted">
                    Order: {{ message_thread.order_number }}
                    <div class="d-none">{{ message_form.order_number | as_crispy_field }}</div>
                </p>
                {{ message_form.body | as_crispy_field }}
                <div class="text-end">
                    <button type="submit" class="btn btn-success">Send</button>
                </div>
            </form>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col">
            <h3>Previous Messages</h3>
            <hr>
        </div>
    </div>

    <div class="row mb-5">

        {% for message in customer_messages %}

            <div class="col-12 mb-4">
                
                <div class="card border-0">
                    <div class="card-body">
                        <h5 class="card-title">{{ message.subject }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{ message.user }}</h6>
                        <hr>
                        <p class="card-text copy-font">"{{ message.body }}"</p>
                        <hr>
                            <div class="text-end text-muted">
                                <small>{% if message.thread.order_number %}Order Number: <a href="{% url 'order_detail' message.thread.order_number %}">{{ message.thread.order_number }}</a>&nbsp;|&nbsp;{% endif %}{{ message.date }}</small>
                    </div>
                    </div>
              </div>

            </div>

        {% endfor %}
    </div>

    <hr>

    <div class="row mb-5">

        <div class="col-12 text-end">
            <a href="{% url 'customer_info' %}" class="btn btn-secondary">Return</a>
        </div>

    </div>
   

</div>
{% endblock %}